<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Docker4Drupal by Wodby</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Docker4Drupal</h1>
      <h2 class="project-tagline">Docker-based local environment for Drupal</h2>
      <a href="https://github.com/Wodby/drupal-compose" class="btn">View on GitHub</a>
      <a href="https://github.com/Wodby/drupal-compose/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/Wodby/drupal-compose/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="docker-based-environment-for-drupal" class="anchor" href="#docker-based-environment-for-drupal" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Docker-based environment for Drupal</h1>

<p>Use this Docker compose file to spin up local environment for Drupal with a <em>native Docker app</em> on Linux, Mac OS X and Windows. </p>

<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#instructions">Instructions</a></li>
<li><a href="#drush">Drush</a></li>
<li><a href="#composer">Composer</a></li>
<li><a href="#xdebug">Xdebug</a></li>
<li><a href="#database">Database</a></li>
<li><a href="#cache">Cache</a></li>
<li><a href="#mailhog">Mailhog</a></li>
<li><a href="#phpmyadmin">phpMyAdmin</a></li>
<li><a href="#apache-solr">Apache Solr</a></li>
<li><a href="#accessing-containers">Accessing containers</a></li>
<li><a href="#logs">Logs</a></li>
<li><a href="#updating">Updating</a></li>
<li><a href="#status">Status</a></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
<li><a href="#going-beyond-local-machine">Going beyond local machine</a></li>
</ul>

<h2>
<a id="overview" class="anchor" href="#overview" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Overview</h2>

<p>The Drupal bundle consist of the following containers:</p>

<table>
<thead>
<tr>
<th>Container</th>
<th>Service name</th>
<th>Volume</th>
<th>Port</th>
<th>Enabled by default</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://hub.docker.com/r/wodby/drupal-nginx/">Nginx</a></td>
<td>nginx</td>
<td></td>
<td>8000</td>
<td>✓</td>
</tr>
<tr>
<td><a href="https://hub.docker.com/r/wodby/drupal-php/">PHP 7, 5.6</a></td>
<td>php</td>
<td><code>./</code></td>
<td></td>
<td>✓</td>
</tr>
<tr>
<td><a href="https://hub.docker.com/r/wodby/drupal-mariadb/">MariaDB</a></td>
<td>mariadb</td>
<td><code>./docker-runtime/mariadb</code></td>
<td></td>
<td>✓</td>
</tr>
<tr>
<td><a href="https://hub.docker.com/r/phpmyadmin/phpmyadmin">phpMyAdmin</a></td>
<td>pma</td>
<td></td>
<td>8001</td>
<td>✓</td>
</tr>
<tr>
<td><a href="https://hub.docker.com/r/mailhog/mailhog">Mailhog</a></td>
<td>mailhog</td>
<td></td>
<td>8002</td>
<td>✓</td>
</tr>
<tr>
<td><a href="https://hub.docker.com/_/redis/">Redis</a></td>
<td>redis</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><a href="https://hub.docker.com/_/memcached/">Memcached</a></td>
<td>memcached</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><a href="https://hub.docker.com/_/solr">Apache Solr</a></td>
<td>solr</td>
<td><code>./docker-runtime/solr</code></td>
<td>8003</td>
<td></td>
</tr>
</tbody>
</table>

<p>PHP, Nginx and MariaDB configs are optimized to be used with Drupal. We regularly update this bundle with performance improvements, bug fixes and newer version of Nginx/PHP/MariaDB.</p>

<h2>
<a id="instructions" class="anchor" href="#instructions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Instructions</h2>

<p><strong>Feel free to adjust volumes and ports in the compose file for your convenience.</strong></p>

<p>Supported Drupal versions: 7 and 8</p>

<p>Supported PHP versions: 7.x and 5.6.x.</p>

<p>1. Install docker for <a href="https://docs.docker.com/engine/installation/">Linux</a>, <a href="https://docs.docker.com/engine/installation/mac">Mac OS X</a> or <a href="https://docs.docker.com/engine/installation/windows">Windows</a>. <strong>For Mac and Windows make sure you're installing native docker app version 1.12, not docker toolbox.</strong> </p>

<p>For Linux additionally install <a href="https://docs.docker.com/compose/install/">docker compose</a></p>

<p>2. Download <a href="https://raw.githubusercontent.com/Wodby/drupal-compose/master/docker-compose.yml">the compose file</a> from this repository and put it to your Drupal project codebase (you might want to add docker-compose.yml to .gitignore). </p>

<p>3. Since containers <a href="https://docs.docker.com/engine/tutorials/dockervolumes/">do not have a permanent storage</a>, directories from the host machine (volumes) should be mounted: one with code of your Drupal project and another with database files. </p>

<p>By default, the directory with the compose file (volume <code>./</code>) will be mounted to PHP container (assuming it's your codebase directory). Additionally <code>docker-runtime</code> directory will be created to store files for mariadb and, optionally, solr containers. Do not forget to add <code>docker-runtime</code> to your .gitignore file. </p>

<p><strong>Linux only</strong>: fix permissions for your files directory with:</p>

<div class="highlight highlight-source-shell"><pre>$ sudo chgrp -R 82 sites/default/files
$ sudo chmod -R 775 sites/default/files</pre></div>

<p>4. Choose Drupal version by modifying the following environment variable (could be 7 or 8) in the compose file:</p>

<div class="highlight highlight-source-yaml"><pre><span class="pl-c1"><span class="pl-ent">DRUPAL_VERSION:</span> 8</span></pre></div>

<p>Choose PHP version by modifying the name of the image:</p>

<div class="highlight highlight-source-yaml"><pre><span class="pl-s"><span class="pl-ent">image:</span> <span class="pl-s">wodby/drupal-php:7.0 </span></span><span class="pl-c"># Allowed: 7.0, 5.6</span></pre></div>

<p>5. Update database credentials in your settings.php file:</p>

<pre><code>database: drupal
username: drupal
password: drupal
host: mariadb
</code></pre>

<p>6. If you want to import your database, uncomment the following line in the compose file:</p>

<div class="highlight highlight-source-yaml"><pre><span class="pl-c">#      - ./docker-runtime/mariadb-init:/docker-entrypoint-initdb.d # Place init .sql file(s) her</span></pre></div>

<p>Create the volume directory <code>./docker-runtime/mariadb-init</code> in the same directory as the compose file and put there your SQL file(s). All SQL files will be automatically imported once MariaDB container has started.</p>

<p>7. Now, let's run the compose file. It will download the images and run the containers:</p>

<div class="highlight highlight-source-shell"><pre>$ docker-compose up -d</pre></div>

<p>8. Make sure all containers are running by executing:</p>

<div class="highlight highlight-source-shell"><pre>$ docker-compose ps</pre></div>

<p>9. That's it! You drupal website should be up and running at http://localhost:8000. </p>

<h2>
<a id="drush" class="anchor" href="#drush" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Drush</h2>

<p>PHP container has installed drush. When running drush make sure to open the shell as user 82 (www-data) to avoid access problems in the web server, which is running as user 82, too:</p>

<div class="highlight highlight-source-shell"><pre>$ docker-compose <span class="pl-c1">exec</span> --user 82 php drush</pre></div>

<h2>
<a id="composer" class="anchor" href="#composer" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Composer</h2>

<p>PHP container has installed composer. Example:</p>

<div class="highlight highlight-source-shell"><pre>$ docker-compose <span class="pl-c1">exec</span> --user 82 php composer update</pre></div>

<h2>
<a id="xdebug" class="anchor" href="#xdebug" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Xdebug</h2>

<p>If you want to use xdebug, uncomment the following line in the compose file:</p>

<div class="highlight highlight-source-yaml"><pre><span class="pl-c">#    XDEBUG_CONFIG: xdebug.remote_autostart=1</span></pre></div>

<p>See the <a href="https://github.com/Wodby/drupal-php/issues/1">known issue</a> with Xdebug in Mac OS.</p>

<h2>
<a id="database" class="anchor" href="#database" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Database</h2>

<h3>
<a id="export" class="anchor" href="#export" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Export</h3>

<p>Exporting all databases:</p>

<div class="highlight highlight-source-shell"><pre>docker-compose <span class="pl-c1">exec</span> mariadb sh -c <span class="pl-s"><span class="pl-pds">'</span>exec mysqldump --all-databases -uroot -p"root-password"<span class="pl-pds">'</span></span> <span class="pl-k">&gt;</span> databases.sql</pre></div>

<p>Exporting a specific database:</p>

<div class="highlight highlight-source-shell"><pre>docker-compose <span class="pl-c1">exec</span> mariadb sh -c <span class="pl-s"><span class="pl-pds">'</span>exec mysqldump -uroot -p"root-password" my-db<span class="pl-pds">'</span></span> <span class="pl-k">&gt;</span> my-db.sql</pre></div>

<h2>
<a id="cache" class="anchor" href="#cache" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Cache</h2>

<h3>
<a id="redis" class="anchor" href="#redis" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Redis</h3>

<p>To spin up a container with Redis cache and use it as a default cache storage follow these steps:</p>

<ol>
<li>Uncomment lines with redis service definition in the compose file.</li>
<li>Download and install <a href="https://www.drupal.org/project/redis">redis module</a> </li>
<li>Add the following lines to the settings.php file:</li>
</ol>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$conf</span>[<span class="pl-s"><span class="pl-pds">'</span>redis_client_host<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>redis<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"><span class="pl-smi">$conf</span>[<span class="pl-s"><span class="pl-pds">'</span>redis_client_interface<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>PhpRedis<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"><span class="pl-smi">$conf</span>[<span class="pl-s"><span class="pl-pds">'</span>lock_inc<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-smi">$contrib_path</span> <span class="pl-k">.</span> <span class="pl-s"><span class="pl-pds">'</span>/redis/redis.lock.inc<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"><span class="pl-smi">$conf</span>[<span class="pl-s"><span class="pl-pds">'</span>path_inc<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-smi">$contrib_path</span> <span class="pl-k">.</span> <span class="pl-s"><span class="pl-pds">'</span>/redis/redis.path.inc<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"><span class="pl-smi">$conf</span>[<span class="pl-s"><span class="pl-pds">'</span>cache_backends<span class="pl-pds">'</span></span>][] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>sites/all/modules/redis/redis.autoload.inc<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"><span class="pl-smi">$conf</span>[<span class="pl-s"><span class="pl-pds">'</span>cache_default_class<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Redis_Cache<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"><span class="pl-smi">$conf</span>[<span class="pl-s"><span class="pl-pds">'</span>cache_class_cache_form<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>DrupalDatabaseCache<span class="pl-pds">'</span></span>;</span></pre></div>

<h3>
<a id="memcached" class="anchor" href="#memcached" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Memcached</h3>

<p>To spin up a container with Memcached and use it as a default cache storage follow these steps:</p>

<ol>
<li>Uncomment lines with memcached service definition in the compose file.</li>
<li>Download and install <a href="https://www.drupal.org/project/memcache">memcache module</a> </li>
<li>Add the following lines to the settings.php file:</li>
</ol>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$conf</span>[<span class="pl-s"><span class="pl-pds">'</span>cache_backends<span class="pl-pds">'</span></span>][] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>sites/all/modules/memcache/memcache.inc<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"><span class="pl-smi">$conf</span>[<span class="pl-s"><span class="pl-pds">'</span>lock_inc<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>sites/all/modules/memcache/memcache-lock.inc<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"><span class="pl-smi">$conf</span>[<span class="pl-s"><span class="pl-pds">'</span>memcache_stampede_protection<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-c1">TRUE</span>;</span>
<span class="pl-s1"><span class="pl-smi">$conf</span>[<span class="pl-s"><span class="pl-pds">'</span>cache_default_class<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>MemCacheDrupal<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"><span class="pl-smi">$conf</span>[<span class="pl-s"><span class="pl-pds">'</span>cache_class_cache_form<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>DrupalDatabaseCache<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"><span class="pl-smi">$conf</span>[<span class="pl-s"><span class="pl-pds">'</span>memcache_servers<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>memcached:11211<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>default<span class="pl-pds">'</span></span>);</span></pre></div>

<h2>
<a id="mailhog" class="anchor" href="#mailhog" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Mailhog</h2>

<p>By default, container with mailhog included in the bundle. It will catch all email sent from the PHP container. You can view emails by visiting its admin UI on localhost:8002.</p>

<h2>
<a id="phpmyadmin" class="anchor" href="#phpmyadmin" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>phpMyAdmin</h2>

<p>By default, container with phpMyAdmin included in the bundle. You can accessit by localhost:8001</p>

<h2>
<a id="apache-solr" class="anchor" href="#apache-solr" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Apache Solr</h2>

<p>To spin up a container with Apache Solr search engine uncomment lines with solr service definition in the compose file. Use  volume directory <code>./docker-runtime/solr</code> to access configuration files. Solr admin UI can be accessed by localhost:8003</p>

<h2>
<a id="accessing-containers" class="anchor" href="#accessing-containers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Accessing containers</h2>

<p>You can connect to any container by executing the following command:</p>

<div class="highlight highlight-source-shell"><pre>$ docker-compose <span class="pl-c1">exec</span> php sh</pre></div>

<p>Replace <code>php</code> with the name of your service (e.g. <code>mariadb</code>, <code>nginx</code>).</p>

<h2>
<a id="logs" class="anchor" href="#logs" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Logs</h2>

<p>To get logs from a container simply run (skip the last param to get logs form all the containers):</p>

<pre><code>$ docker-compose logs [service]
</code></pre>

<p>Example: real-time logs of the PHP container:</p>

<pre><code>$ docker-compose logs -f php
</code></pre>

<h2>
<a id="updating" class="anchor" href="#updating" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Updating</h2>

<p>We update containers from time to time, to get the lastest changes simply run again:</p>

<pre><code>$ docker-compose up -d
</code></pre>

<h2>
<a id="status" class="anchor" href="#status" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Status</h2>

<p>We're actively working on this instructions and containers. More options will be added soon. If you have a feature request or found a bug please sumbit an issue.</p>

<h2>
<a id="troubleshooting" class="anchor" href="#troubleshooting" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Troubleshooting</h2>

<p>In case you have any problems submit an issue or contact us at hello [at] wodby.com.</p>

<h2>
<a id="going-beyond-local-machine" class="anchor" href="#going-beyond-local-machine" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Going beyond local machine</h2>

<p>Check out <a href="https://wodby.com">Wodby</a> if you need optimized consistent docker-based environment for Drupal on your dev/staging or production servers. </p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/Wodby/drupal-compose">Docker4Drupal</a> is maintained by <a href="https://github.com/Wodby">Wodby</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
